{"ast":null,"code":"import \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/table/style/css\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/statistic/style/css\";\nimport _Statistic from \"antd/lib/statistic\";\nimport \"antd/lib/alert/style/css\";\nimport _Alert from \"antd/lib/alert\";\nimport \"antd/lib/tag/style/css\";\nimport _Tag from \"antd/lib/tag\";\nimport \"antd/lib/tooltip/style/css\";\nimport _Tooltip from \"antd/lib/tooltip\";\nimport \"antd/lib/popconfirm/style/css\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/popover/style/css\";\nimport _Popover from \"antd/lib/popover\";\nimport \"antd/lib/descriptions/style/css\";\nimport _Descriptions from \"antd/lib/descriptions\";\nimport \"antd/lib/page-header/style/css\";\nimport _PageHeader from \"antd/lib/page-header\";\nimport \"antd/lib/typography/style/css\";\nimport _Typography from \"antd/lib/typography\";\nimport \"antd/lib/form/style/css\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/modal/style/css\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/input-number/style/css\";\nimport _InputNumber from \"antd/lib/input-number\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport { UserOutlined, SolutionOutlined, CheckOutlined, TeamOutlined, GlobalOutlined, CoffeeOutlined } from '@ant-design/icons';\nimport { Space, TextCenter } from '@/components/container';\nimport { Context, defaultContext } from '@/utils/global';\nimport Steps from '@/components/steps';\nimport { LoginModal } from '@/components/login';\nimport { get, finish, update, insert, land, out } from '@/extensions/queue/api';\nimport moment from '@/utils/moment';\nimport TextArea from 'antd/lib/input/TextArea';\nimport ShowNotification, { H5Notification } from '@/utils/notification';\nimport { withRouter } from 'next/router';\nimport If from '@/components/if';\n\nclass QueueDetail extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"context\", void 0);\n\n    _defineProperty(this, \"ws\", void 0);\n\n    _defineProperty(this, \"formRef\", React.createRef());\n\n    _defineProperty(this, \"getData\", () => {\n      this.setState({\n        loading: true\n      });\n      get(this.props.router.query.id).then(r => this.setState({\n        queue: r.queue\n      })).finally(() => this.setState({\n        loading: false,\n        refresh: moment.now() + 30 * 1000\n      }));\n    });\n\n    _defineProperty(this, \"update\", () => {\n      const forms = [{\n        key: 'max',\n        name: '同时登岛人数',\n        children: __jsx(_InputNumber, {\n          max: 7,\n          min: 1,\n          placeholder: \"\\u4E0D\\u5305\\u62EC\\u81EA\\u5DF1\"\n        }),\n        initial: this.state.queue.max\n      }, {\n        key: 'password',\n        name: '登岛密码',\n        children: __jsx(_Input, {\n          placeholder: \"\\u767B\\u5C9B\\u5BC6\\u7801(\\u65E0\\u5BC6\\u7801\\u7559\\u7A7A)\"\n        }),\n        initial: this.state.queue.password\n      }, {\n        key: 'description',\n        name: '描述',\n        children: __jsx(TextArea, {\n          autoSize: {\n            minRows: 5\n          }\n        }),\n        initial: this.state.queue.description\n      }];\n      const initialValues = Object.assign({}, ...forms.map(item => ({\n        [item.key]: item.initial\n      })));\n\n      _Modal.confirm({\n        title: '编辑信息',\n        okText: '修改信息',\n        cancelText: '取消修改',\n        content: __jsx(_Form, {\n          ref: this.formRef,\n          initialValues: initialValues,\n          labelCol: {\n            span: 4\n          },\n          wrapperCol: {\n            span: 20\n          }\n        }, forms.map(item => __jsx(_Form.Item, {\n          key: item.key,\n          name: item.key,\n          label: item.name\n        }, item.children))),\n        okButtonProps: {\n          loading: this.state.formLoading\n        },\n        onOk: async () => {\n          this.setState({\n            formLoading: true\n          });\n          const {\n            max,\n            password,\n            description\n          } = this.formRef.current.getFieldsValue(true);\n          const r = await update(this.props.queue.id, max, password, description);\n          this.setState({\n            formLoading: false\n          });\n\n          if (ShowNotification(r)) {\n            this.getData();\n          } else {\n            return Promise.reject();\n          }\n        }\n      });\n    });\n\n    _defineProperty(this, \"insert\", () => {\n      this.setState({\n        opLoading: true\n      });\n      insert(this.props.queue.id).then(r => {\n        ShowNotification(r);\n        this.getData();\n        H5Notification('入队成功，请密切关注队伍更新状态');\n      }).finally(() => this.setState({\n        opLoading: false\n      }));\n    });\n\n    _defineProperty(this, \"land\", memberID => {\n      this.setState({\n        opLoading: true\n      });\n      land(this.props.queue.id, memberID).then(r => {\n        ShowNotification(r);\n        this.getData();\n      }).finally(() => this.setState({\n        opLoading: false\n      }));\n    });\n\n    _defineProperty(this, \"out\", memberID => {\n      this.setState({\n        opLoading: true\n      });\n      out(this.props.queue.id, memberID).then(r => {\n        ShowNotification(r);\n        this.getData();\n      }).finally(() => this.setState({\n        opLoading: false\n      }));\n    });\n\n    _defineProperty(this, \"onPageChange\", pagination => {\n      var {\n        current,\n        pageSize\n      } = pagination;\n      if (typeof current === 'undefined') current = this.state.page;\n      if (typeof pageSize === 'undefined') pageSize = this.state.size;\n      this.setState({\n        page: current,\n        size: pageSize\n      }, this.getData);\n    });\n\n    _defineProperty(this, \"renderHeader\", () => {\n      return __jsx(_PageHeader, {\n        title: \"\\u52A8\\u68EE\\u5019\\u673A\\u5927\\u5385\",\n        subTitle: `前往 ${this.props.queue.leader.ac_island}岛(${this.props.queue.leader.ac_name})`\n      }, __jsx(_Typography.Paragraph, null, \"\\u4F7F\\u7528\\u8BE5\\u7CFB\\u7EDF\\u9700\\u8981\\u6CE8\\u518C\\u8D26\\u53F7\\uFF0C\\u5E76\\u586B\\u5199 Nintendo \\u8D26\\u53F7\\u540D\\u3001ID\\uFF0C\\u52A8\\u68EE\\u540D\\u79F0\\u3001\\u5C9B\\u540D\\uFF0CQQ \\u53F7\\u4EE5\\u53CA\\u7ED1\\u5B9A QQ \\u4E00\\u952E\\u767B\\u5F55\"), __jsx(_Typography.Paragraph, null, \"QQ \\u53F7\\u5C06\\u4E8E\\u7528\\u4E8E QQ \\u673A\\u5668\\u4EBA\\u63D0\\u9192\\uFF08\\u9700\\u8981\\u548C QQ \\u673A\\u5668\\u4EBA\\u4E3A\\u597D\\u53CB\\u5173\\u7CFB\\uFF0C\\u6216\\u5728\\u540C\\u4E00\\u4E2A\\u7FA4\\u5185\\uFF0C\\u53EF\\u52A0\\u7FA4\\uFF1A797585867\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u591A\\u8D9F\\u4E70\\u5356\\u5927\\u5934\\u83DC\\uFF0C\\u8BF7\\u591A\\u6B21\\u6392\\u961F\\uFF0C\\u4EE5\\u63D0\\u5347\\u6548\\u7387\\uFF08\\u4E70\\u5B8C\\u76F4\\u63A5\\u51CF\\u53F7\\u952E\\u56DE\\u5BB6\\uFF0C\\u5355\\u4EBA\\u4E0A\\u5C9B\\uFF0C\\u6548\\u7387\\u66F4\\u9AD8\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u5F53\\u8F6E\\u5230\\u4F60\\u767B\\u673A\\u8D77\\u98DE\\u65F6\\uFF0C\\u8BF7\\u5C3D\\u5FEB\\u8D77\\u98DE\\u3002\\u843D\\u5730\\u3001\\u56DE\\u5BB6\\u540E\\u8BF7\\u53CA\\u65F6\\u6309\\u4E0B\\u76F8\\u5173\\u6309\\u94AE\\u3002\\u5982\\u679C\\u591A\\u6B21\\u5728\\u72B6\\u6001\\u66F4\\u65B0\\u540E\\u672A\\u6309\\u4E0B\\u6309\\u94AE\\u4FEE\\u6539\\u72B6\\u6001\\uFF0C\\u5C06\\u4F1A\\u88AB\\u7CFB\\u7EDF\\u62C9\\u9ED1\\uFF0C\\u65E0\\u6CD5\\u4F7F\\u7528\\u8BE5\\u7CFB\\u7EDF\\u3002\"), __jsx(_Typography.Paragraph, null, \"\\u4E3A\\u4E86\\u907F\\u514D\\u70B8\\u5C9B\\uFF0C\\u8054\\u673A\\u6E38\\u620F\\u8BF7\\u5C3D\\u53EF\\u80FD\\u4F7F\\u7528\\u6D41\\u91CF\\u5F00\\u70ED\\u70B9\\u5E76\\u5F00\\u542F\", __jsx(\"a\", {\n        href: \"https://lingti.paiyou.co/signup?c=ir9bam\",\n        target: \"_blank\"\n      }, \"\\u52A0\\u901F\\u5668\"), \"\\uFF08\\u90E8\\u5206\\u52A0\\u901F\\u5668\\u52A0\\u901F\\u540E\\u66F4\\u6162\\uFF0C\\u8BF7\\u4E0D\\u8981\\u7528\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u5982\\u679C\\u5BCC\\u88D5\\uFF0C\\u8BF7\\u7ED9\\u5C9B\\u6C11\\u4EE3\\u8868\\u7559\\u4E0B\\u793C\\u7269\\u3002\\u4E0D\\u8981\\u4E71\\u52A8\\u5C9B\\u6C11\\u4EE3\\u8868\\u7684\\u4E1C\\u897F\\uFF0C\\u8BF7\\u4E25\\u683C\\u9075\\u5B88\\u5C9B\\u6C11\\u4EE3\\u8868\\u7684\\u8981\\u6C42\"));\n    });\n\n    _defineProperty(this, \"renderInfo\", () => {\n      return __jsx(Space, null, __jsx(_Descriptions, {\n        title: \"\\u5019\\u673A\\u5385\\u4FE1\\u606F\",\n        bordered: true\n      }, __jsx(_Descriptions.Item, {\n        label: \"\\u5C9B\\u5C7F\\u540D\\u79F0\"\n      }, this.state.queue.leader.ac_island, \"\\u5C9B\"), __jsx(_Descriptions.Item, {\n        label: \"\\u5C9B\\u6C11\\u4EE3\\u8868\"\n      }, __jsx(_Popover, {\n        title: \"\\u4E2A\\u4EBA\\u4FE1\\u606F\",\n        content: __jsx(_Descriptions, {\n          size: \"small\",\n          column: 2,\n          bordered: true\n        }, __jsx(_Descriptions.Item, {\n          label: \"\\u5C9B\\u5C7F\\u540D\\u79F0\"\n        }, this.state.queue.leader.ac_island, \"\\u5C9B\"), __jsx(_Descriptions.Item, {\n          label: \"\\u5C9B\\u6C11\\u4EE3\\u8868\"\n        }, this.state.queue.leader.ac_name), __jsx(_Descriptions.Item, {\n          label: \"Nintendo Switch ID\"\n        }, \"SW-\", this.state.queue.leader.ns_id), __jsx(_Descriptions.Item, {\n          label: \"Nintendo Switch \\u7528\\u6237\\u540D\"\n        }, this.state.queue.leader.ns_name))\n      }, __jsx(\"span\", null, __jsx(Link, {\n        href: \"/user/[username]\",\n        as: `/user/${this.state.queue.leader.username}`\n      }, __jsx(\"a\", {\n        target: \"_blank\"\n      }, this.state.queue.leader.ac_name))))), __jsx(_Descriptions.Item, {\n        label: \"\\u6700\\u5927\\u540C\\u65F6\\u4E0A\\u5C9B\\u4EBA\\u6570\\u9650\\u5236\"\n      }, this.state.queue.max), __jsx(_Descriptions.Item, {\n        label: \"\\u63CF\\u8FF0\\u4FE1\\u606F\",\n        style: {\n          whiteSpace: 'pre'\n        }\n      }, this.state.queue.description)), __jsx(If, {\n        condition: this.context.user.id == this.props.queue.leader.id || (this.context.user.permission & 1) === 1\n      }, __jsx(Space, {\n        direction: \"horizontal\",\n        flexCenter: true\n      }, __jsx(_Button, {\n        onClick: this.update\n      }, \"\\u7F16\\u8F91\\u4FE1\\u606F\"), __jsx(_Popconfirm, {\n        title: \"\\u786E\\u5B9A\\u8981\\u5173\\u95ED\\u673A\\u573A\\uFF1F\\u5173\\u95ED\\u673A\\u573A\\u540E\\u8BE5\\u961F\\u4F0D\\u4E0D\\u5728\\u4F1A\\u4EA7\\u751F\\u53D8\\u52A8\\uFF0C\\u4E14\\u9664\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5916\\uFF0C\\u65E0\\u6CD5\\u6062\\u590D\\u3002\",\n        onConfirm: async () => {\n          const r = await finish(this.props.router.query.id);\n          ShowNotification(r);\n        },\n        okText: \"\\u5173\\u95ED\\uFF01\",\n        cancelText: \"\\u7B97\\u4E86\"\n      }, __jsx(_Button, {\n        danger: true\n      }, \"\\u5173\\u95ED\\u673A\\u573A\")))));\n    });\n\n    _defineProperty(this, \"renderTable\", () => {\n      const keys = [{\n        key: 'in_time',\n        name: '排队中',\n        color: 'gold',\n        time: '入队时间'\n      }, {\n        key: 'land_time',\n        name: '已着陆',\n        color: 'green',\n        time: '着陆时间'\n      }, {\n        key: 'out_time',\n        name: '已出队',\n        color: 'red',\n        time: '返回时间'\n      }];\n      var columns = [{\n        title: '玩家信息',\n        key: 'username',\n        width: 200,\n        ellipsis: true,\n        render: (_, record) => __jsx(Link, {\n          href: \"/user/[username]\",\n          as: `/user/${record.user.username}`\n        }, __jsx(\"a\", {\n          target: \"_blank\"\n        }, record.user.ac_island, \"\\u5C9B - \", record.user.ac_name))\n      }, {\n        title: '入队时间',\n        key: 'in_time',\n        sorter: (a, b) => a.in_time - b.in_time,\n        defaultSortOrder: 'ascend',\n        width: 200,\n        ellipsis: true,\n        render: (_, record) => {\n          const time = moment(record.in_time, 'X');\n          return __jsx(_Tooltip, {\n            title: time.format('YYYY-MM-DD HH:mm:ss')\n          }, __jsx(\"span\", null, time.fromNow()));\n        }\n      }, {\n        title: '状态',\n        key: 'status',\n        width: 200,\n        ellipsis: true,\n        filters: keys.map(item => ({\n          text: item.name,\n          value: item.key\n        })),\n        defaultFilteredValue: ['in_time', 'land_time'],\n        onFilter: (value, record) => {\n          switch (value) {\n            case 'in_time':\n              return record.in_time != 0 && record.land_time == 0 && record.out_time == 0;\n\n            case 'land_time':\n              return record.in_time != 0 && record.land_time != 0 && record.out_time == 0;\n\n            case 'out_time':\n              return record.out_time != 0;\n\n            default:\n              return false;\n          }\n        },\n        render: (_, record) => {\n          var res = __jsx(_Tag, null, \"\\u672A\\u77E5\\u72B6\\u6001\");\n\n          for (var i = 0; i < keys.length; i++) {\n            if (record[keys[i].key] !== 0) {\n              res = __jsx(_Tag, {\n                color: keys[i].color\n              }, keys[i].name);\n            }\n          }\n\n          return res;\n        }\n      }];\n\n      if ((this.context.user.permission & 1) === 1 || this.context.user.id === this.props.queue.leader.id) {\n        columns.push({\n          title: '操作',\n          key: 'op',\n          ellipsis: true,\n          render: (_, record) => {\n            return __jsx(_Popconfirm, {\n              title: \"\\u786E\\u8BA4\\u5F3A\\u5236\\u51FA\\u961F\\uFF1F\",\n              onConfirm: () => this.out(record.id)\n            }, __jsx(_Button, {\n              danger: true\n            }, \"\\u5F3A\\u5236\\u51FA\\u961F\"));\n          }\n        });\n      }\n\n      const doingQueue = this.state.queue.queue.filter(item => item.out_time === 0);\n      const waitingQueue = this.state.queue.queue.filter(item => item.out_time === 0 && item.land_time === 0);\n      var memberID = '';\n      var status = 2;\n\n      if (!this.context.user.existed) {\n        status = 0;\n      } else if (this.context.user.qq_connected == false || this.context.user.ns_id == '' || this.context.user.ns_name == '' || this.context.user.ac_name == '' || this.context.user.ac_island == '') {\n        status = 1;\n      } else {\n        for (var i = 0; i < doingQueue.length; i++) {\n          if (doingQueue[i].user.id === this.context.user.id) {\n            memberID = doingQueue[i].id;\n\n            for (var j = 0; j < keys.length; j++) {\n              if (doingQueue[i][keys[j].key] === 0) {\n                status = 2 + j;\n                break;\n              }\n            }\n\n            break;\n          }\n        }\n      }\n\n      return __jsx(Space, {\n        size: \"middle\"\n      }, waitingQueue.length > 0 ? __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, \"\\u8BF7\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, waitingQueue[0].user.ac_island, \"\\u5C9B\\u7684\", waitingQueue[0].user.ac_name), ' ', \"\\u51C6\\u5907\\u53D1\\u5C04\\uFF01\\u5DF2\\u670D\\u52A1\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, this.state.queue.queue.length - waitingQueue.length), ' ', \"\\u540D\\u4E58\\u5BA2\\uFF0C\\u8FD8\\u6709 \", __jsx(_Typography.Text, {\n          strong: true\n        }, waitingQueue.length), ' ', \"\\u540D\\u4E58\\u5BA2\\u5728\\u7B49\\u5F85\"),\n        type: \"info\"\n      }) : doingQueue.length > 0 ? __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, __jsx(_Typography.Text, {\n          strong: true\n        }, doingQueue[0].user.ac_island, \"\\u5C9B\\u7684\", doingQueue[0].user.ac_name), ' ', \"\\u6B63\\u5728\\u64CD\\u4F5C\\uFF01\\u5DF2\\u670D\\u52A1\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, this.state.queue.queue.length), \" \\u540D\\u4E58\\u5BA2\"),\n        type: \"info\"\n      }) : __jsx(_Alert, {\n        showIcon: true,\n        message: `所有乘客已登机落地,共服务乘客 ${this.state.queue.queue.length} 名`,\n        type: \"success\"\n      }), __jsx(If, {\n        condition: this.state.queue.password != '' && waitingQueue.length > 0 && waitingQueue[0].user.id == this.context.user.id\n      }, __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, \"\\u4E0A\\u5C9B\\u5BC6\\u7801\\uFF1A\", __jsx(_Typography.Text, {\n          strong: true\n        }, this.state.queue.password.toUpperCase()), \"\\uFF0C\\u8BF7\\u5C3D\\u5FEB\\u4E0A\\u5C9B\\uFF01\"),\n        type: \"success\"\n      })), __jsx(TextCenter, null, __jsx(_Statistic.Countdown, {\n        title: this.state.queue.finish_time === 0 ? '下次自动刷新倒计时' : '已关岛',\n        value: this.state.queue.finish_time === 0 ? this.state.refresh : 0,\n        onFinish: this.state.queue.finish_time === 0 ? this.getData : () => {},\n        format: \"HH:mm:ss:SSS\"\n      }), __jsx(_Button, {\n        loading: this.state.loading,\n        onClick: this.getData\n      }, \"\\u5237\\u65B0\\u6570\\u636E\")), __jsx(Steps, {\n        current: status,\n        size: \"small\"\n      }, __jsx(Steps.Step, {\n        title: \"\\u6CE8\\u518C\\u5E76\\u767B\\u5F55\",\n        icon: __jsx(UserOutlined, null)\n      }, __jsx(TextCenter, null, __jsx(_Button, {\n        type: \"primary\",\n        onClick: () => this.setState({\n          loginModal: true\n        })\n      }, \"\\u6CE8\\u518C/\\u767B\\u5F55\"))), __jsx(Steps.Step, {\n        title: \"\\u5B8C\\u5584\\u4FE1\\u606F\",\n        icon: __jsx(SolutionOutlined, null)\n      }, __jsx(Space, {\n        textCenter: true\n      }, __jsx(Link, {\n        href: \"/user/[username]\",\n        as: `/user/${this.context.user.username}`\n      }, __jsx(\"a\", {\n        target: \"_blank\"\n      }, __jsx(_Button, {\n        type: \"primary\"\n      }, \"\\u5B8C\\u5584\\u4E2A\\u4EBA\\u4FE1\\u606F\"))), __jsx(\"p\", null, \"\\u586B\\u5199\\u5B8C\\u6210\\u540E\\uFF0C\\u4F60\\u9700\\u8981\\u5237\\u65B0\\u5F53\\u524D\\u9875\\u9762\"))), __jsx(Steps.Step, {\n        title: \"\\u672A\\u6392\\u961F\",\n        icon: __jsx(CoffeeOutlined, null)\n      }, __jsx(TextCenter, null, __jsx(_Button, {\n        loading: this.state.opLoading,\n        onClick: this.insert\n      }, \"\\u6211\\u8981\\u6392\\u961F\"))), __jsx(Steps.Step, {\n        title: \"\\u6B63\\u5728\\u6392\\u961F\",\n        icon: __jsx(TeamOutlined, null)\n      }, __jsx(Space, {\n        direction: \"horizontal\",\n        flexCenter: true\n      }, __jsx(_Button, {\n        loading: this.state.opLoading,\n        onClick: () => this.land(memberID)\n      }, \"\\u6211\\u5DF2\\u964D\\u843D\"), __jsx(_Button, {\n        loading: this.state.opLoading,\n        onClick: () => this.out(memberID)\n      }, \"\\u53D6\\u6D88\\u6392\\u961F\"))), __jsx(Steps.Step, {\n        title: \"\\u5DF2\\u7740\\u9646\",\n        icon: __jsx(GlobalOutlined, null)\n      }, __jsx(TextCenter, null, __jsx(_Button, {\n        loading: this.state.opLoading,\n        onClick: () => this.out(memberID)\n      }, \"\\u6211\\u5DF2\\u8FD4\\u822A\"))), __jsx(Steps.Step, {\n        title: \"\\u5DF2\\u8FD4\\u822A\",\n        icon: __jsx(CheckOutlined, null)\n      })), __jsx(_Table, {\n        rowKey: record => record.id,\n        dataSource: this.state.queue.queue,\n        scroll: {\n          x: 'auto'\n        },\n        onChange: this.onPageChange,\n        loading: this.state.loading,\n        pagination: {\n          current: this.state.page,\n          total: this.state.total,\n          pageSize: this.state.size,\n          showSizeChanger: true\n        },\n        columns: columns,\n        expandable: {\n          expandedRowRender: record => __jsx(_Descriptions, {\n            bordered: true\n          }, keys.map(item => {\n            const time = moment(record[item.key], 'X');\n            return __jsx(_Descriptions.Item, {\n              key: item.name,\n              label: item.time\n            }, record[item.key] == 0 ? '未到达该状态' : __jsx(_Tooltip, {\n              title: time.fromNow()\n            }, __jsx(\"span\", null, time.format('YYYY-MM-DD HH:mm:ss'))));\n          }))\n        }\n      }));\n    });\n\n    this.state = {\n      loading: false,\n      formLoading: false,\n      total: 0,\n      queue: {\n        id: '',\n        leader: defaultContext.user,\n        password: '',\n        description: '',\n        max: 0,\n        create_time: 0,\n        finish_time: 0,\n        queue: []\n      },\n      all: false,\n      page: 1,\n      size: 10,\n      opLoading: false,\n      refresh: 0,\n      loginModal: false\n    };\n  }\n\n  static async getInitialProps(args) {\n    const r = await get(args.query.id);\n    return {\n      queue: r.queue\n    };\n  }\n\n  componentDidMount() {\n    this.getData();\n    this.ws = new WebSocket(`${window.location.origin.replace('http', 'ws')}/api/notification/ws?name=queue`);\n\n    this.ws.onmessage = msg => {\n      const obj = JSON.parse(msg.data);\n\n      if (typeof obj.data === 'object' && typeof obj.data.message === 'string') {\n        H5Notification(obj.data.message);\n        ShowNotification({\n          success: true,\n          title: '排队通知',\n          content: obj.data.message\n        });\n        this.getData();\n      }\n    };\n\n    window.addEventListener('beforeunload', this.componentWillMount);\n  }\n\n  componentWillUnmount() {\n    if (!!this.ws) this.ws.close();\n  }\n\n  render() {\n    return __jsx(\"div\", null, __jsx(Context.Consumer, null, context => __jsx(Head, null, __jsx(\"title\", null, `前往${this.props.queue.leader.ac_island}岛(${this.props.queue.leader.ac_name})|动森候机大厅|${context.blog_name}`))), __jsx(Space, null, __jsx(_Card, null, this.renderHeader()), __jsx(_Card, null, this.renderInfo()), __jsx(_Card, null, this.renderTable())), __jsx(LoginModal, {\n      show: this.state.loginModal,\n      onClose: () => this.setState({\n        loginModal: false\n      })\n    }));\n  }\n\n}\n\n_defineProperty(QueueDetail, \"contextType\", Context);\n\nexport default withRouter(QueueDetail);","map":null,"metadata":{},"sourceType":"module"}