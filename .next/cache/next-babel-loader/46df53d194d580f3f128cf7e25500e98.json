{"ast":null,"code":"import _toConsumableArray from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Card from '@/components/card';\nimport Popover, { Tooltip } from '@/components/popover';\nimport Avatar from '@/components/avatar';\nimport { CheckBox } from '@/components/input';\nimport Button from '@/components/button';\nimport Pagination from '@/components/pagination';\nimport { Flex } from '@/components/container';\nimport Loading from '@/components/loading';\nimport { Context } from '@/utils/global';\nimport { commentDelete, commentsAdmin, commentSet, commentsAvatar } from '@/utils/api';\nimport moment from '@/utils/moment';\nimport ShowNotification from '@/utils/notification';\nimport { concat } from '@/utils/component';\nimport textStyles from '@/styles/text.module.scss';\nvar defaultAvatar = 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png';\n\nfunction Comment(props) {\n  var comment = props.comment,\n      restProps = _objectWithoutProperties(props, [\"comment\"]);\n\n  var time = moment(comment.time);\n  return /*#__PURE__*/_jsxs(Flex, _objectSpread(_objectSpread({}, restProps), {}, {\n    subAxis: \"flex-start\",\n    wrap: false,\n    children: [/*#__PURE__*/_jsx(Flex.Item, {\n      style: {\n        flex: '0 0 2em',\n        display: 'flex',\n        justifyContent: 'center'\n      },\n      children: /*#__PURE__*/_jsx(Avatar, {\n        src: comment.avatar ? comment.avatar : defaultAvatar,\n        style: {\n          width: '1.5em',\n          height: '1.5em'\n        }\n      })\n    }), /*#__PURE__*/_jsx(Flex.Item, {\n      style: {\n        flex: '1 1 auto'\n      },\n      children: /*#__PURE__*/_jsxs(Flex, {\n        mainSize: \"small\",\n        direction: \"TB\",\n        fullWidth: true,\n        children: [/*#__PURE__*/_jsxs(Flex, {\n          mainAxis: \"flex-start\",\n          children: [comment.email, /*#__PURE__*/_jsx(Tooltip, {\n            title: time.format('YYYY-MM-DD HH:mm:ss'),\n            children: /*#__PURE__*/_jsx(\"span\", {\n              className: concat(textStyles.secondary, textStyles.em75),\n              children: time.fromNow()\n            })\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: concat(textStyles.secondary, textStyles.em75),\n            children: comment.id\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: concat(textStyles.secondary, textStyles.em75),\n            children: comment.ip\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: concat(textStyles.secondary, textStyles.em75),\n            children: comment.position\n          })]\n        }), !!comment.reply_comment && comment.reply_comment.id !== '000000000000000000000000' ? /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            borderLeft: '#ccc 5px solid',\n            paddingLeft: 10\n          },\n          children: /*#__PURE__*/_jsx(Comment, {\n            comment: comment.reply_comment\n          })\n        }) : null, /*#__PURE__*/_jsx(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: comment.content\n          }\n        })]\n      })\n    })]\n  }));\n}\n\nvar AdminComments = /*#__PURE__*/function (_React$Component) {\n  _inherits(AdminComments, _React$Component);\n\n  var _super = _createSuper(AdminComments);\n\n  function AdminComments(props) {\n    var _this;\n\n    _classCallCheck(this, AdminComments);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"getData\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var r;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.setState({\n                loading: true\n              });\n\n              _context.next = 3;\n              return commentsAdmin(_this.state.page, _this.state.size);\n\n            case 3:\n              r = _context.sent;\n\n              _this.setState({\n                data: r.comments,\n                total: r.total,\n                loading: false\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (page, size) {\n      _this.setState({\n        page: page,\n        size: size\n      }, _this.getData);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"checkboxChange\", function (checked, id, key) {\n      _this.setState(function (state) {\n        var data = state.data;\n        data.map(function (item) {\n          if (item.id === id) {\n            item[key] = checked;\n          }\n\n          return item;\n        });\n        return {\n          data: data\n        };\n      });\n    });\n\n    _this.state = {\n      loading: false,\n      total: 0,\n      data: [],\n      page: 1,\n      size: 10\n    };\n    return _this;\n  }\n\n  _createClass(AdminComments, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getData();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var items = [{\n        key: 'show',\n        value: '显示'\n      }, {\n        key: 'ad',\n        value: '广告'\n      }, {\n        key: 'recv',\n        value: '接收提醒'\n      }];\n      return /*#__PURE__*/_jsx(Card, {\n        neumorphism: true,\n        children: /*#__PURE__*/_jsx(Context.Consumer, {\n          children: function children(context) {\n            return /*#__PURE__*/_jsxs(React.Fragment, {\n              children: [/*#__PURE__*/_jsx(Head, {\n                children: /*#__PURE__*/_jsx(\"title\", {\n                  children: \"\\u8BC4\\u8BBA\\u5217\\u8868|\\u540E\\u53F0|\".concat(context.blog_name)\n                })\n              }), /*#__PURE__*/_jsxs(Flex, {\n                fullWidth: true,\n                direction: \"TB\",\n                children: [/*#__PURE__*/_jsxs(Flex, {\n                  direction: \"LR\",\n                  children: [/*#__PURE__*/_jsxs(\"p\", {\n                    children: [\"\\u5171 \", _this2.state.total, \" \\u6761\\u8BC4\\u8BBA\"]\n                  }), /*#__PURE__*/_jsx(Button, {\n                    neumorphism: true,\n                    loading: _this2.state.loading,\n                    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                        while (1) {\n                          switch (_context2.prev = _context2.next) {\n                            case 0:\n                              _this2.setState({\n                                loading: true\n                              });\n\n                              _context2.t0 = ShowNotification;\n                              _context2.next = 4;\n                              return commentsAvatar();\n\n                            case 4:\n                              _context2.t1 = _context2.sent;\n                              (0, _context2.t0)(_context2.t1);\n\n                              _this2.setState({\n                                loading: false\n                              });\n\n                            case 7:\n                            case \"end\":\n                              return _context2.stop();\n                          }\n                        }\n                      }, _callee2);\n                    })),\n                    children: \"\\u66F4\\u65B0\\u5934\\u50CF\"\n                  })]\n                }), /*#__PURE__*/_jsx(Loading, {\n                  loading: _this2.state.loading,\n                  children: _this2.state.data.map(function (comment, idx) {\n                    return /*#__PURE__*/_jsxs(Flex, {\n                      mainAxis: \"space-between\",\n                      wrap: !context.big_screen,\n                      children: [/*#__PURE__*/_jsx(Flex.Item, {\n                        style: {\n                          flex: '1 1 auto'\n                        },\n                        children: /*#__PURE__*/_jsx(Comment, {\n                          comment: comment\n                        })\n                      }), /*#__PURE__*/_jsx(Flex.Item, {\n                        style: {\n                          flex: '0 0 auto'\n                        },\n                        children: /*#__PURE__*/_jsxs(Flex, {\n                          direction: \"TB\",\n                          subAxis: \"flex-end\",\n                          children: [/*#__PURE__*/_jsxs(\"a\", {\n                            href: comment.url,\n                            target: \"_blank\",\n                            children: [\"\\u300A\", comment.title !== '' ? comment.title : '评论区', \"\\u300B\"]\n                          }), /*#__PURE__*/_jsx(Flex, {\n                            children: items.map(function (item) {\n                              return /*#__PURE__*/_jsx(CheckBox, {\n                                value: comment[item.key],\n                                onChange: function onChange(c) {\n                                  return _this2.setState(function (state) {\n                                    var data = state.data;\n                                    data[idx][item.key] = c;\n                                    return {\n                                      data: _toConsumableArray(data)\n                                    };\n                                  });\n                                },\n                                children: item.value\n                              });\n                            })\n                          }), /*#__PURE__*/_jsxs(Flex, {\n                            direction: \"LR\",\n                            children: [/*#__PURE__*/_jsx(Popover, {\n                              shadow: true,\n                              card: true,\n                              trigger: ['click'],\n                              component: /*#__PURE__*/_jsxs(Card, {\n                                children: [/*#__PURE__*/_jsx(\"span\", {\n                                  children: \"\\u771F\\u7684\\u8981\\u5220\\u9664\\u4E48\\uFF1F\"\n                                }), /*#__PURE__*/_jsx(Button, {\n                                  onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                                    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                                      while (1) {\n                                        switch (_context3.prev = _context3.next) {\n                                          case 0:\n                                            _context3.t0 = ShowNotification;\n                                            _context3.next = 3;\n                                            return commentDelete(comment.id);\n\n                                          case 3:\n                                            _context3.t1 = _context3.sent;\n\n                                            if (!(0, _context3.t0)(_context3.t1)) {\n                                              _context3.next = 6;\n                                              break;\n                                            }\n\n                                            _this2.getData();\n\n                                          case 6:\n                                          case \"end\":\n                                            return _context3.stop();\n                                        }\n                                      }\n                                    }, _callee3);\n                                  })),\n                                  danger: true,\n                                  neumorphism: true,\n                                  primary: true,\n                                  size: \"small\",\n                                  children: \"\\u5220\\u9664\\uFF01\"\n                                })]\n                              }),\n                              children: /*#__PURE__*/_jsx(Button, {\n                                neumorphism: true,\n                                danger: true,\n                                children: \"\\u5220\\u9664\"\n                              })\n                            }), /*#__PURE__*/_jsx(Button, {\n                              neumorphism: true,\n                              onClick: /*#__PURE__*/function () {\n                                var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e) {\n                                  var r;\n                                  return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                                    while (1) {\n                                      switch (_context4.prev = _context4.next) {\n                                        case 0:\n                                          _context4.next = 2;\n                                          return commentSet(comment.id, comment.ad, comment.recv, comment.show);\n\n                                        case 2:\n                                          r = _context4.sent;\n                                          ShowNotification(r);\n\n                                        case 4:\n                                        case \"end\":\n                                          return _context4.stop();\n                                      }\n                                    }\n                                  }, _callee4);\n                                }));\n\n                                return function (_x) {\n                                  return _ref4.apply(this, arguments);\n                                };\n                              }(),\n                              children: \"\\u4FDD\\u5B58\"\n                            })]\n                          })]\n                        })\n                      })]\n                    }, comment.id);\n                  })\n                }), /*#__PURE__*/_jsx(Pagination, {\n                  disabled: _this2.state.loading,\n                  sizeSelect: [5, 10, 20, 50, 100],\n                  page: _this2.state.page,\n                  size: _this2.state.size,\n                  total: _this2.state.total,\n                  onChange: _this2.onChange\n                })]\n              })]\n            });\n          }\n        })\n      });\n    }\n  }]);\n\n  return AdminComments;\n}(React.Component);\n\n_defineProperty(AdminComments, \"defaultProps\", {});\n\nexport default AdminComments;","map":null,"metadata":{},"sourceType":"module"}