{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Card from '@/components/card';\nimport Popover, { Tooltip } from '@/components/popover';\nimport Avatar from '@/components/avatar';\nimport { CheckBox } from '@/components/input';\nimport Button from '@/components/button';\nimport Pagination from '@/components/pagination';\nimport { Flex } from '@/components/container';\nimport Loading from '@/components/loading';\nimport { Context } from '@/utils/global';\nimport { commentDelete, commentsAdmin, commentSet, commentsAvatar } from '@/utils/api';\nimport moment from '@/utils/moment';\nimport ShowNotification from '@/utils/notification';\nimport { concat } from '@/utils/component';\nimport textStyles from '@/styles/text.module.scss';\nconst defaultAvatar = 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png';\n\nfunction Comment(props) {\n  const {\n    comment\n  } = props,\n        restProps = _objectWithoutProperties(props, [\"comment\"]);\n\n  const time = moment(comment.time);\n  return /*#__PURE__*/_jsxs(Flex, _objectSpread(_objectSpread({}, restProps), {}, {\n    subAxis: \"flex-start\",\n    wrap: false,\n    children: [/*#__PURE__*/_jsx(Flex.Item, {\n      style: {\n        flex: '0 0 2em',\n        display: 'flex',\n        justifyContent: 'center'\n      },\n      children: /*#__PURE__*/_jsx(Avatar, {\n        src: comment.avatar ? comment.avatar : defaultAvatar,\n        style: {\n          width: '1.5em',\n          height: '1.5em'\n        }\n      })\n    }), /*#__PURE__*/_jsx(Flex.Item, {\n      style: {\n        flex: '1 1 auto'\n      },\n      children: /*#__PURE__*/_jsxs(Flex, {\n        mainSize: \"small\",\n        direction: \"TB\",\n        fullWidth: true,\n        children: [/*#__PURE__*/_jsxs(Flex, {\n          mainAxis: \"flex-start\",\n          children: [comment.email, /*#__PURE__*/_jsx(Tooltip, {\n            title: time.format('YYYY-MM-DD HH:mm:ss'),\n            children: /*#__PURE__*/_jsx(\"span\", {\n              className: concat(textStyles.secondary, textStyles.em75),\n              children: time.fromNow()\n            })\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: concat(textStyles.secondary, textStyles.em75),\n            children: comment.id\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: concat(textStyles.secondary, textStyles.em75),\n            children: comment.ip\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: concat(textStyles.secondary, textStyles.em75),\n            children: comment.position\n          })]\n        }), !!comment.reply_comment && comment.reply_comment.id !== '000000000000000000000000' ? /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            borderLeft: '#ccc 5px solid',\n            paddingLeft: 10\n          },\n          children: /*#__PURE__*/_jsx(Comment, {\n            comment: comment.reply_comment\n          })\n        }) : null, /*#__PURE__*/_jsx(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: comment.content\n          }\n        })]\n      })\n    })]\n  }));\n}\n\nclass AdminComments extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"getData\", async () => {\n      this.setState({\n        loading: true\n      });\n      var r = await commentsAdmin(this.state.page, this.state.size);\n      this.setState({\n        data: r.comments,\n        total: r.total,\n        loading: false\n      });\n    });\n\n    _defineProperty(this, \"onChange\", (page, size) => {\n      this.setState({\n        page,\n        size\n      }, this.getData);\n    });\n\n    _defineProperty(this, \"checkboxChange\", (checked, id, key) => {\n      this.setState(state => {\n        var {\n          data\n        } = state;\n        data.map(item => {\n          if (item.id === id) {\n            item[key] = checked;\n          }\n\n          return item;\n        });\n        return {\n          data\n        };\n      });\n    });\n\n    this.state = {\n      loading: false,\n      total: 0,\n      data: [],\n      page: 1,\n      size: 10\n    };\n  }\n\n  componentDidMount() {\n    this.getData();\n  }\n\n  render() {\n    const items = [{\n      key: 'show',\n      value: '显示'\n    }, {\n      key: 'ad',\n      value: '广告'\n    }, {\n      key: 'recv',\n      value: '接收提醒'\n    }];\n    return /*#__PURE__*/_jsx(Card, {\n      neumorphism: true,\n      children: /*#__PURE__*/_jsx(Context.Consumer, {\n        children: context => /*#__PURE__*/_jsxs(React.Fragment, {\n          children: [/*#__PURE__*/_jsx(Head, {\n            children: /*#__PURE__*/_jsx(\"title\", {\n              children: `评论列表|后台|${context.blog_name}`\n            })\n          }), /*#__PURE__*/_jsxs(Flex, {\n            fullWidth: true,\n            direction: \"TB\",\n            children: [/*#__PURE__*/_jsxs(Flex, {\n              direction: \"LR\",\n              children: [/*#__PURE__*/_jsxs(\"p\", {\n                children: [\"\\u5171 \", this.state.total, \" \\u6761\\u8BC4\\u8BBA\"]\n              }), /*#__PURE__*/_jsx(Button, {\n                neumorphism: true,\n                loading: this.state.loading,\n                onClick: async () => {\n                  this.setState({\n                    loading: true\n                  });\n                  ShowNotification(await commentsAvatar());\n                  this.setState({\n                    loading: false\n                  });\n                },\n                children: \"\\u66F4\\u65B0\\u5934\\u50CF\"\n              })]\n            }), /*#__PURE__*/_jsx(Loading, {\n              loading: this.state.loading,\n              children: this.state.data.map((comment, idx) => /*#__PURE__*/_jsxs(Flex, {\n                mainAxis: \"space-between\",\n                wrap: !context.big_screen,\n                children: [/*#__PURE__*/_jsx(Flex.Item, {\n                  style: {\n                    flex: '1 1 auto'\n                  },\n                  children: /*#__PURE__*/_jsx(Comment, {\n                    comment: comment\n                  })\n                }), /*#__PURE__*/_jsx(Flex.Item, {\n                  style: {\n                    flex: '0 0 auto'\n                  },\n                  children: /*#__PURE__*/_jsxs(Flex, {\n                    direction: \"TB\",\n                    subAxis: \"flex-end\",\n                    children: [/*#__PURE__*/_jsxs(\"a\", {\n                      href: comment.url,\n                      target: \"_blank\",\n                      children: [\"\\u300A\", comment.title !== '' ? comment.title : '评论区', \"\\u300B\"]\n                    }), /*#__PURE__*/_jsx(Flex, {\n                      children: items.map(item => /*#__PURE__*/_jsx(CheckBox, {\n                        value: comment[item.key],\n                        onChange: c => this.setState(state => {\n                          var {\n                            data\n                          } = state;\n                          data[idx][item.key] = c;\n                          return {\n                            data: [...data]\n                          };\n                        }),\n                        children: item.value\n                      }))\n                    }), /*#__PURE__*/_jsxs(Flex, {\n                      direction: \"LR\",\n                      children: [/*#__PURE__*/_jsx(Popover, {\n                        shadow: true,\n                        card: true,\n                        trigger: ['click'],\n                        component: /*#__PURE__*/_jsxs(Card, {\n                          children: [/*#__PURE__*/_jsx(\"span\", {\n                            children: \"\\u771F\\u7684\\u8981\\u5220\\u9664\\u4E48\\uFF1F\"\n                          }), /*#__PURE__*/_jsx(Button, {\n                            onClick: async () => {\n                              if (ShowNotification(await commentDelete(comment.id))) this.getData();\n                            },\n                            danger: true,\n                            neumorphism: true,\n                            primary: true,\n                            size: \"small\",\n                            children: \"\\u5220\\u9664\\uFF01\"\n                          })]\n                        }),\n                        children: /*#__PURE__*/_jsx(Button, {\n                          neumorphism: true,\n                          danger: true,\n                          children: \"\\u5220\\u9664\"\n                        })\n                      }), /*#__PURE__*/_jsx(Button, {\n                        neumorphism: true,\n                        onClick: async e => {\n                          const r = await commentSet(comment.id, comment.ad, comment.recv, comment.show);\n                          ShowNotification(r);\n                        },\n                        children: \"\\u4FDD\\u5B58\"\n                      })]\n                    })]\n                  })\n                })]\n              }, comment.id))\n            }), /*#__PURE__*/_jsx(Pagination, {\n              disabled: this.state.loading,\n              sizeSelect: [5, 10, 20, 50, 100],\n              page: this.state.page,\n              size: this.state.size,\n              total: this.state.total,\n              onChange: this.onChange\n            })]\n          })]\n        })\n      })\n    });\n  }\n\n}\n\n_defineProperty(AdminComments, \"defaultProps\", {});\n\nexport default AdminComments;","map":null,"metadata":{},"sourceType":"module"}